box: ruby:2.4.1
build:
  steps:
    - bundle-install
    - script:
        name: rspec
        code: bundle exec rspec
deploy-pre-release:
  steps:
    - bundle-install
    - add-ssh-key:
        keyname: GITHUB_KEY
    - wercker/add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 82:84:0b:a7:f2:30:6a:42:ef:77:d4:ef:e1:f1:d8:78
        local: true
        type: rsa
    - script:
        name: configure git
        code: |
          cat ~/.ssh/config
          git config --global user.email "ymarquet@gmail.com"
          git config --global user.name "StupidCodefactory"
          ssh -T git@github.com
          git push --set-upstream origin master
    - script:
        name: configure gem
        code: |
          echo -e  "---\n:rubygems_api_key: $GEM_API_KEY\n" >> ~/.gem/credentials
          chmod 0600 ~/.gem/credentials
    - script:
        name: configure bump and tag
        code: |
          cat ~/.gem/credentials
          bundle exec gem bump -v pre -k ~/.gem/credentials
    - script:
        name: configure release
        code: |
          bundle exec gem release -k ~/.gem/credentials -t
