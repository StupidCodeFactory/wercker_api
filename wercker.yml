box: ruby:2.4.1
build:
  steps:
    - bundle-install
    - script:
        name: rspec
        code: bundle exec rspec
deploy-pre-release:
  steps:
    - bundle-install
    - script:
        name: configure git
        code: |
          git config --global user.email "ymarquet@gmail.com"
          git config --global user.name "StupidCodefactory"
    - add-ssh-key:
        keyname: GITHUB
    # - wercker/add-to-known_hosts@2.0.1:
    #     hostname: github.com
    #     fingerprint: 4d:de:af:f1:29:53:df:e1:26:f9:92:b9:cc:dc:e3:07
    - script:
        name: configure gem
        code: |
          echo -e  "---\n:rubygems_api_key: $GEM_API_KEY\n" >> ~/.gem/credentials
          chmod 0600 ~/.gem/credentials
    - script:
        name: configure bump and tag
        code: |
          cat ~/.gem/credentials
          bundle exec gem bump -v pre -k ~/.gem/credentials
    - script:
        name: configure release
        code: |
          bundle exec gem release -k ~/.gem/credentials -t
