box: ruby:2.4.1
build:
  steps:
    - bundle-install
    - script:
        name: rspec
        code: bundle exec rspec
deploy-pre-release:
  steps:
    - bundle-install
    - add-ssh-key:
        keyname: GITHUB_KEY
    - wercker/add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - script:
        name: configure git
        code: |
          git config --global user.email "ymarquet@gmail.com"
          git config --global user.name "StupidCodefactory"
          git config --global push.default simple
          git branch --set-upstream master origin/master
    - script:
        name: gem build
        code: |
          rake build
    - script:
        name: configure release
        code: |
          git status
          rake release
          # curl --data-binary @$(ls -1 *.gem) -H "Authorization: $GEM_API_KEY" https://rubygems.org/api/v1/gems
