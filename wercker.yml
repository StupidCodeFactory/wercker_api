box: ruby:2.4.1
build:
  steps:
    - bundle-install
    - script:
        name: rspec
        code: bundle exec rspec
deploy-pre-release:
  steps:
    - bundle-install
    - add-ssh-key:
        keyname: GITHUB_KEY
    - script:
        name: debug
        code: |
          cat /etc/ssh/known_hosts
    - wercker/add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - script:
        name: configure git
        code: |
          cat ~/.ssh/config
          git config --global user.email "ymarquet@gmail.com"
          git config --global user.name "StupidCodefactory"
          ssh -T git@github.com
          git push --set-upstream origin master
    - script:
        name: configure gem
        code: |
          echo -e  "---\n:rubygems_api_key: $GEM_API_KEY\n" >> ~/.gem/credentials
          chmod 0600 ~/.gem/credentials
    - script:
        name: configure bump and tag
        code: |
          cat ~/.gem/credentials
          bundle exec gem bump -v pre -k ~/.gem/credentials
    - script:
        name: configure release
        code: |
          bundle exec gem release -k ~/.gem/credentials -t
